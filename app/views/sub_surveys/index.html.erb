<div class="card-header white-text primary-color">
  <h5>随访任务列表</h5>
</div>
<table id="sub_survey_index_table" class="table table-striped table-bordered" cellspacing="0" width="100%">
  <thead>
  <tr>
    <th>随访名</th>
    <th>随访描述</th>
    <th>随访发起人</th>
    <th>任务开始日期</th>
    <th>当前进度</th>
    <th>操作</th>
  </tr>
  </thead>

  <tbody>

  <% @sub_surveys.each do |s| %>
    <tr>
      <td>
        <%= s.survey.name %>
      </td>
      <td>
        <%= s.survey.description %>
      </td>
      <td>
        <% ranDoc = rand(4) %>
        <% if ranDoc == 0 %>
          王援朝 主任
        <% elsif ranDoc == 1 %>
          马晓燕 医生
        <% elsif ranDoc == 2 %>
          范德彪 医生
        <% elsif ranDoc == 3 %>
          方正 医生
        <% end %>
      </td>
      <td>
        <%= s.start_date %>
      </td>
      <td>
        <% ran = rand(4) %>
        <% if ran == 0 %>
          <div class="progress mb-3">
            <div class="progress-bar bg-danger" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        <% elsif ran == 1 %>
            <div class="progress mb-3">
              <div class="progress-bar bg-warning" role="progressbar" style="width: 40%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        <% elsif ran == 2 %>
          <div class="progress mb-3">
            <div class="progress-bar bg-primary" role="progressbar" style="width: 66%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        <% elsif ran == 3 %>
          <div class="progress mb-3">
            <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        <% end %>
      </td>
      <td>
        <%= link_to '开始任务', s, class:'btn btn-primary btn-sm' %>
        <%= link_to '查看上层随访内容', s.survey, class:'btn btn-success btn-sm' %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<script>
    function onReady() {
        setTimeout(
            function()
            {
                $('#sub_survey_index_table').DataTable({
                        "pagingType": "full_numbers",
                        "autoWidth": true,
                        "order": [[ 3, "desc" ]]
                    }
                );
                $('#sub_survey_index_table_wrapper').find('label').each(function () {
                    $(this).parent().append($(this).children());
                });
                $('#sub_survey_index_table_wrapper .dataTables_filter').find('input').each(function () {
                    $('input').attr("placeholder", "Search");
                    $('input').removeClass('form-control-sm');
                });
                $('#sub_survey_index_table_wrapper .dataTables_length').addClass('d-flex flex-row');
                $('#sub_survey_index_table_wrapper .dataTables_filter').addClass('md-form');
                $('#sub_survey_index_table_wrapper select').removeClass(
                    'custom-select custom-select-sm form-control form-control-sm');
                $('#sub_survey_index_table_wrapper select').addClass('mdb-select');
                $('#sub_survey_index_table_wrapper .mdb-select').materialSelect();
                $('#sub_survey_index_table_wrapper .dataTables_filter').find('label').remove();
            }, 100);
    }
    onReady()
</script>